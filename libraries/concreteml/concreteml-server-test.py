from fastapi import FastAPI, HTTPException, Request, Response, Depends
from fastapi.security import HTTPBearer, HTTPAuthorizationCredentials
import os
import base64
import httpx
from tempfile import TemporaryDirectory
from shutil import unpack_archive
from pathlib import Path
from concrete.ml.deployment import FHEModelClient, FHEModelDev, FHEModelServer
import asyncio
import nest_asyncio
import json

nest_asyncio.apply()

app = FastAPI()
security = HTTPBearer()

CONTAINER_ID = os.getenv("CONTAINER_ID")
MODEL_ID = os.getenv("MODEL_ID")
SERVER_PORT = 80  # Default port for HTTP
AUTH_SERVER_URL = os.getenv("AUTH_SERVER_URL")
CLIENTZIP_BASE64 ="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"
SERVERZIP_BASE64 = "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"


async def verify_token(credentials: HTTPAuthorizationCredentials = Depends(security)):
    apikey = credentials.credentials
    headers = {"Authorization": f"Bearer {apikey}"}
    body = {"model_id": MODEL_ID, "container_id": CONTAINER_ID}
    async with httpx.AsyncClient() as client:
        response = await client.post(AUTH_SERVER_URL, headers=headers, json=body)
        if response.status_code != 200:
            raise HTTPException(status_code=401, detail="Invalid token")
        data = response.json()
        if not data.get("result"):
            raise HTTPException(status_code=401, detail="Authentication failed")
        return True


def save_base64_and_json_to_zip(client_base64, json_str, zip_path):
    with TemporaryDirectory() as tempdir:
        client_specs_path = os.path.join(tempdir, "client.specs.json")
        with open(client_specs_path, "w") as json_file:
            json.dump(json.loads(json_str), json_file)

        client_zip_path = os.path.join(tempdir, "client.zip")
        decode_and_save_base64(client_base64, client_zip_path)

        with zipfile.ZipFile(zip_path, "w") as zipf:
            zipf.write(client_specs_path, "client.specs.json")
            zipf.write(client_zip_path, "client.zip")


def save_base64_to_zip(base64_str, zip_path):
    with open(zip_path, "wb") as f:
        f.write(base64.b64decode(base64_str))


def save_base64_zip(encoded_str, output_dir, output_filename):
    # Ensure the output directory exists
    output_dir_path = Path(output_dir)
    output_dir_path.mkdir(parents=True, exist_ok=True)

    # Decode the base64 encoded string
    zip_bytes = base64.b64decode(encoded_str)

    # Define the output file path
    zip_path = output_dir_path / output_filename

    # Write the bytes to the zip file
    with open(zip_path, "wb") as zip_file:
        zip_file.write(zip_bytes)

    # Return the path to the saved zip file
    return str(zip_path)


@app.get("/test")
async def test():
    print("success")
    return Response("hello world!")


@app.get("/init")
async def get_client():
    client_zip_base64 = CLIENTZIP_BASE64
    client_zip_bytes = base64.b64decode(client_zip_base64)
    return Response(content=client_zip_bytes, media_type="application/zip")


# 이건 클라이언트에서만 실행하는것. 테스트용으로 실행함
@app.get("/make")
async def get_evaluation_key():
    # Let's create the client and load the model
    output_dir = "/home/jovyan/output"

    save_base64_zip(CLIENTZIP_BASE64, output_dir, "client.zip")
    save_base64_zip(SERVERZIP_BASE64, output_dir, "server.zip")

    fhemodel_client = FHEModelClient(output_dir, key_dir=output_dir)
    # The client first need to create the private and evaluation keys.
    serialized_evaluation_keys = fhemodel_client.get_serialized_evaluation_keys()
    #print(serialized_evaluation_keys)
    return Response("ev made")


@app.get("/predict")
async def predict():
    body = await request.json()
    evaluation_key = body.get("evaluation_key")
    encrypted_data = body.get("encrypted_data")

    server_zip_base64 = SERVERZIP_BASE64
    server_zip_bytes = base64.b64decode(server_zip_base64)
    with TemporaryDirectory() as tmpdirname:
        server_zip_path = Path(tmpdirname) / "server.zip"
        with open(server_zip_path, "wb") as f:
            f.write(server_zip_bytes)

        unpack_archive(server_zip_path, tmpdirname, "zip")
        fhe_model_server = FHEModelServer(tmpdirname)

        encrypted_prediction = fhe_model_server.run(encrypted_data, evaluation_key)

        return {"encrypted_prediction": base64.b64encode(encrypted_prediction).decode()}


if __name__ == "__main__":
    import uvicorn

    uvicorn.run(app, host="0.0.0.0", port=SERVER_PORT)